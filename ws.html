<!DOCTYPE html>
<html>
<head>
	<title>ws</title>
	<script type="text/javascript" src="https://cdn.bootcss.com/require.js/2.3.5/require.min.js
"></script>

</head>
<body>
	<input type="text" name="input">
	<button type="button">submit</button>
	<p class="content"></p>
<script type="text/javascript">
	require.config({
	    baseUrl:"./js/",
	    paths: {
	        "jquery": "jquery.min",
	    }  
	});
	require(['jquery',"./client"], function($,Nes) {
	    var client = new Nes.Client('ws://localhost:1000');
		const start = async () => {
		    await client.connect();
		};
		start()

		const fetch = async (step,url) => {
			step = step > 1 ? step : 1
			const payload = await client.request({path: '/post',method: 'POST',payload:{step,url}});
		}

		client.onUpdate = (update) => {
			for (var i = 0; i < update.length; i++) {
				(async function(uri) {
					const post = await fetchPage(uri)
					console.log(update)
				})(update[i])
			}
	    };

	    const fetchPage = async (url) => {
			const page = await fetch(2,url)
			return page
	    }
		
		$('button').on('click',async function(){
			await fetch(1)
			const data = $('input').val()
			$('.content').text('正在获取')
			//const name = await fetch(data)
		})
	});
</script>
</body>
</html>